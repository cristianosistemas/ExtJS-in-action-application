<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />    
  <title>The source code</title>
    <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
    <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
</head>
<body  onload="prettyPrint();">
    <pre class="prettyprint lang-js">Ext.ns('CompanyMgr');

<div id="cls-CompanyMgr.EmployeeEditorWindow"></div>/**
 * @class CompanyMgr.EmployeeEditorWindow
 * @extends Ext.Window
 * An Ext.Window implementation that contains  the {@link Ext.layout.FitLayout fit} layout to
 *  present {@link TKE.form.EmployeeMgrForm} implementation.
 * <br />
 * @constructor
 * @param {Object} config The config object
 **/
CompanyMgr.EmployeeEditorWindow = Ext.extend(Ext.Window, {
    layout    : 'fit',
    modal     : true,
    width     : (Ext.isIE) ? 630 : 615,
    height    : (Ext.isIE) ? 255 : 245,
    resizable : false,
    draggable : false,
    center    : true,
    closable  : false,
    msgs      : {
        dirtyConfirmation : 'Are you sure you want to abandon the changes made to ',
        errorsInForm      : 'There are errors in the form.  Please correct the errors and try again.',
        saving            : 'Saving {0}, {1}',
        failedToSaveEmp   :  'Failed to save {0}, {1}'
    },
    initComponent : function() {
        var title = '';
        if (this.record && this.record.get) {
            title = this.record.get('lastName') + ', ' + this.record.get('firstName');
        }
        Ext.applyIf(this,{
            title   : 'Edit ' + title,
            iconCls : (this.record) ? 'icon-user_edit' : 'icon-user_add',
            items   : {
                xtype  : 'employeeMgrForm',
                border : false,
                itemId : 'employeeMgrForm',
                record : this.record,
                tbar   : null
            },
            buttons : [
                {
                    text    : 'Cancel',
                    iconCls : 'icon-cross',
                    scope   : this,
                    handler : this.onCancelBtn
                },
                {
                    text    : 'Save',
                    iconCls : 'icon-disk',
                    scope   : this,
                    handler : this.onSaveBtn
                }
            ]
        });

        this.addEvents({
            employeeSaved : true
        });
        CompanyMgr.EmployeeEditorWindow.superclass.initComponent.call(this);

        if (this.departmentId) {
            this.on({
                scope       : this,
                afterrender : this.onAfterRenderSetNeweEmployee
            });
        }

    },
    onSaveBtn : function() {
        var formPanel = this.getComponent('employeeMgrForm');

        if (formPanel.getForm().isValid()) {
            var vals = formPanel.getValues();

            var msg = String.format(
                this.msgs.saving,
                vals.firstName,
                vals.lastName
            );

            this.el.mask(msg, 'x-mask-loading');

            formPanel.getForm().submit({
                url              : 'employees/setEmployee',
                scope            : this,
                success          : this.onFormSaveSuccess,
                failure          : this.onFormSaveFailure
            });
        }
        else {
            Ext.MessageBox.alert(
                'Error!',
                this.msgs.errorsInForm
            );
        }
    },
    onCancelBtn : function() {
        this.close();
    },
    onFormSaveSuccess : function(form, action) {
        var vals = form.getValues();
   
        this.fireEvent('employeeSaved', vals, action, this.record);
        this.close();
    },
    onFormSaveFailure : function(form) {
        var vals = form.getValues();
        var msg = String.format(
            this.msgs.failedToSaveEmp,
            vals.lastName,
            vals.firstName
        );
        Ext.MessageBox.alert('Failure', msg);
        this.el.unmask();
    },
    onAfterRenderSetNeweEmployee : function() {
        var formPanel = this.getComponent('employeeMgrForm');
        formPanel.isValid();
        formPanel.getForm().setValues({
            departmentId : this.departmentId,
            dateHired    : new Date()
        });

    }
});</pre>    
</body>
</html>